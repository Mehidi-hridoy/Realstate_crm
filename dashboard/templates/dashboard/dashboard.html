{% extends 'crm/base.html' %}
{% load static %}

{% block title %}
  Dashboard
{% endblock %}

{% block content %}
<div class="container-fluid p-0 m-0 min-vh-90" style="overflow-x: hidden; background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);">

 <!-- Hero Section with Vector Graphic -->
<div class="row align-items-center justify-content-center py-3 m-0" style="background: #1b84ca; min-height: 120px;">
  <div class="col-12 col-md-6 text-white text-center py-2">
    <h1 class="fw-bold mb-2" style="font-size: 1.7rem;">
      Welcome {{ user.first_name }} {{ user.last_name }} ({{ user.username }}) to Your Dashboard
    </h1>
    <p class="lead mb-2" style="font-size: 1.1rem;">
      Track your leads and clients visually and efficiently.
    </p>
  </div>
  <div class="col-12 col-md-6 text-center py-2">
    <!-- Smaller SVG Vector Graphic -->
    <svg width="90" height="50" viewBox="0 0 220 120" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 90px; max-height: 50px;">
      <ellipse cx="110" cy="60" rx="100" ry="50" fill="#a5b4fc"/>
      <ellipse cx="110" cy="60" rx="70" ry="35" fill="#818cf8"/>
      <circle cx="110" cy="60" r="25" fill="#6366f1"/>
      <text x="110" y="65" text-anchor="middle" fill="#fff" font-size="18" font-family="Arial" font-weight="bold">CRM</text>
    </svg>
  </div>
</div>





<!-- Cards Section -->
<div class="row my-4 g-3 justify-content-center">

  <div class="col-12 col-md-5">
    <a href="{% url 'followup_next' %}" class="text-decoration-none">
      <div class="card shadow-sm rounded p-4 text-center h-100" style="cursor: pointer; transition: transform 0.2s;">
        <div class="display-1 fw-bold text-primary mb-2">{{ followup_done_count|default:"0" }}</div>
        <h4 class="mb-3 text-primary">Follow Up Done</h4>
        <p class="mb-0 text-muted">View all upcoming follow-ups with updated dates.</p>
      </div>
    </a>
  </div>

  <div class="col-12 col-md-5">
    <a href="{% url 'followup_today' %}" class="text-decoration-none">
      <div class="card shadow-sm rounded p-4 text-center h-100" style="cursor: pointer; transition: transform 0.2s;">
    
      <div class="display-1 fw-bold text-primary mb-2">{{ followup_today_count }}</div>
        <h4 class="mb-3 text-primary">Follow Up Today</h4>
        <p class="mb-0 text-muted">Check today's scheduled follow-ups and edited leads.</p>
      </div>
    </a>
  </div>

</div>

<style>
  .card:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
</style>


  <!-- Main dashboard content -->
  <div class="p-0 m-0">

    <div class="row mb-4 g-0">
      <div class="col-12">
        <div class="d-flex flex-row overflow-auto gap-3 px-0 mt-4 w-100">
          {% comment %} Cards with hover effect {% endcomment %}
          <a href="{% url 'leads_list' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-danger shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s; background: #dc3545;">
              <div class="card-body p-3">
                <h6 class="text-white fw-bold mb-1">Total Active Leads</h6>
                <h5 class="fw-bolder text-white" style="font-size: 2.2rem;">{{total_leads}}</h5>
              </div>
            </div>
          </a>
          
          <a href="{% url 'high_priority_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-danger shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-danger fw-bold mb-1">High Priority</h6>
                <h5 class="fw-bold">{{high_prospect_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'prospect_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-primary shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-primary fw-bold mb-1">Prospect</h6>
                <h5 class="fw-bold">{{prospect_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'junk_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-secondary shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-secondary fw-bold mb-1">Junk</h6>
                <h5 class="fw-bold">{{junk_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'lead_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-warning shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-warning fw-bold mb-1">Lead</h6>
                <h5 class="fw-bold">{{lead_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'lost_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-dark shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-dark fw-bold mb-1">Lost</h6>
                <h5 class="fw-bold">{{lost_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'hold_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-dark shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-dark fw-bold mb-1">Hold</h6>
                <h5 class="fw-bold">{{hold_count}}</h5>
              </div>
            </div>
          </a>
          <a href="{% url 'sold_onboard_leads' %}" class="text-decoration-none flex-fill">
            <div class="card text-center border-success shadow-sm h-100 w-100 card-hover" style="min-width: 0; transition: transform 0.2s;">
              <div class="card-body p-3">
                <h6 class="text-success fw-bold mb-1">Sold</h6>
                <h5 class="fw-bold">{{ sold_count }}</h5>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- Recent Leads Section -->
    <section class="mb-5 px-4">
      <h2 class="mb-3">Recent Leads</h2>
      {% if recent_leads %}
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
          <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Number</th>
          <th>Stage</th>
          <th>Created By</th>
          <th>Team Leader</th>
          <th>Last Modified</th>
          <th>Lead Source</th>
          <th>Sub Source</th>
          <th>Budget</th>
          <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for item in recent_leads %}
          <tr>
            <td>{{ item.unique_id }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.phone|slice:":-3" }}***</td>


            <td class="
              {% if item.get_lead_status_display == 'Prospect' %}
                bg-primary text-white
              {% elif item.get_lead_status_display == 'High Prospect' %}
                bg-danger text-white
              {% elif item.get_lead_status_display == 'Sold/On-board' %}
                bg-success text-white
              {% endif %}">
              {{ item.get_lead_status_display }}
            </td>
            <td>{{ item.created_by }}</td>
            <td>{{ item.teamleader }}</td>
            <td>{{ item.last_modified|date:"Y-m-d H:i" }}</td>
            <td>{{ item.leadsource}}</td>
            <td>{{ item.subsource|default:"Not specified" }}</td>
            <td>{{ item.budget|default:"Not specified" }}</td>
            
            <td>
            <a href="{% url 'lead_details' item.pk %}" class="btn btn-sm btn-info">Read More</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No recent leads found.</p>
      {% endif %}
    </section>

    <!-- Recent Clients Section -->
    <section class="px-4">
      <h2 class="mb-3">Recent Clients</h2>
      {% if recent_clients %}
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
          <tr>
          <th>Name</th>
          <th>Description</th>
          <th class="text-center">Favorite</th>
          <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for client in recent_clients %}
          <tr>
            <td>{{ client.name }}</td>
            <td>
            {% if client.get_description_display %}
              {{ client.get_description_display }}
            {% else %}
              {{ client.description }}
            {% endif %}
            </td>
            <td class="text-center">
            <button class="btn btn-link p-0 star-icon" aria-label="Toggle Favorite" onclick="toggleStar('{{ client.pk }}')">‚≠ê</button>
            </td>
            <td>
            <a href="{% url 'clients_detail' client.pk %}" class="btn btn-sm btn-info">Read More</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No recent clients found.</p>
      {% endif %}
    </section>
  </div>
</div>

<style>
  .card-hover:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 8px 24px rgba(99,102,241,0.15);
    border-width: 2px;
  }
</style>

<script>
  function toggleStar(pk) {
    alert('Toggle favorite for ID: ' + pk);
  }
</script>
{% endblock %}
